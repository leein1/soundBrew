<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Test with Queue Bar</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<body>
<h1>Sound Test with Queue Bar</h1>
<form id="myForm">
    <input type="text" name="albumName" value="amazing album title" />
    <input type="text" name="title" value="amazing song title" />
    <input type="text" name="description" value="pinoKing" />
    <input type="number" name="price" value=3 />
    <input type="text" name="instrument" value="tagone">
    <input type="text" name="instrument" value="tagtwo">
    <button type="submit">Submit</button>
</form>

<!-- JSON 결과를 출력할 영역 -->
<pre id="output" style="background-color: #f4f4f4; padding: 10px; border: 1px solid #ddd;"></pre>

<script type="module">
    import { inputProcessor, inputValidator, inputHandler } from '/js/check/inputHandler.js';
    import { serializeFormToJSON } from '/js/serialize/formTojson.js';

    // axios 인터셉터로 요청을 가로채서 로그 출력
    axios.interceptors.request.use(function (config) {
        // 요청 전에 로그를 출력
        console.log('Request to:', config.url);
        console.log('Request body:', config.data);

        // 실제 요청은 하지 않음
        return Promise.reject(new Error('Mock request!')); // 실제 요청을 차단
    }, function (error) {
        // 에러 발생 시 처리
        return Promise.reject(error);
    });

    document.getElementById("myForm").addEventListener("submit", async (event) => {
        event.preventDefault(); // 기본 폼 제출 방지

        const form = document.getElementById("myForm");
        const jsonData = serializeFormToJSON(form);
        const { errors, processedData } = inputHandler(jsonData, form);

        if (!errors) {
            try {
                // 요청을 보내지 않고 로그만 확인
                await axios.post('/api/create', processedData);
            } catch (err) {
                console.log('Mock request triggered - no actual network request sent');
            }
        }
    });
</script>
</body>
</html>
